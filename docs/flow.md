# Snake 游戏流程图

```mermaid
graph TD
    A[程序启动] --> B[SDL_AppInit]
    B --> C[初始化SDL]
    B --> D[创建窗口和渲染器]
    B --> E[初始化蛇的状态]
    
    E --> F[snake_initialize]
    F --> F1[清空网格]
    F1 --> F2[设置蛇的初始位置]
    F2 --> F3[生成初始食物]
    
    C --> G[游戏主循环 SDL_AppIterate]
    
    G --> H[处理时间步长]
    H --> I[snake_step 更新游戏状态]
    
    I --> I1[移动蛇尾]
    I1 --> I2[移动蛇头]
    I2 --> I3[检查碰撞]
    I3 --> I4{是否碰到食物?}
    I4 -->|是| I5[生成新食物]
    I4 -->|否| I6[继续游戏]
    I5 --> I6
    
    G --> J[渲染游戏画面]
    J --> J1[清空屏幕]
    J1 --> J2[绘制食物]
    J2 --> J3[绘制蛇身]
    J3 --> J4[绘制蛇头]
    J4 --> J5[更新显示]
    
    K[事件处理 SDL_AppEvent] --> L{事件类型}
    L -->|键盘事件| M[handle_key_event]
    L -->|退出事件| N[退出游戏]
    
    M --> M1{按键类型}
    M1 -->|方向键| M2[snake_redir 改变方向]
    M1 -->|R键| M3[重置游戏]
    M1 -->|ESC/Q键| N
    
    N --> O[SDL_AppQuit]
    O --> P[清理资源]
    P --> Q[程序结束]
```

## 流程说明

### 初始化阶段
1. 程序启动后，首先执行 `SDL_AppInit` 进行初始化
2. 初始化 SDL 库，创建窗口和渲染器
3. 通过 `snake_initialize` 初始化蛇的状态
   - 设置初始位置和方向
   - 生成初始食物

### 游戏主循环
1. `SDL_AppIterate` 负责游戏主循环
2. 根据时间步长更新游戏状态
3. `snake_step` 处理蛇的移动逻辑
   - 更新蛇尾位置
   - 更新蛇头位置
   - 处理碰撞检测
   - 处理食物收集
4. 渲染游戏画面

### 事件处理
1. `SDL_AppEvent` 处理用户输入
2. 键盘事件通过 `handle_key_event` 处理
   - 方向键：改变蛇的移动方向
   - R 键：重置游戏
   - ESC/Q 键：退出游戏

### 游戏结束
1. 收到退出事件后执行 `SDL_AppQuit`
2. 清理资源并结束程序